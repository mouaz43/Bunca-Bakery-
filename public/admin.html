<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>Admin – BUNCA Planner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/styles.css">
</head>
<body class="wrap">
  <header class="nav">
    <div class="brand">BUNCA Planner</div>
    <nav>
      <a href="/">Dashboard</a>
      <a href="/production">Production</a>
      <a href="/admin" class="active">Admin</a>
      <button id="logout">Logout</button>
    </nav>
  </header>

  <section class="card">
    <h2>Seed aus Repo</h2>
    <p>Importiert <code>db/seed/*.json</code> (Rohwaren, Artikel, Rezepte).</p>
    <button id="seed">Seed ausführen</button>
    <pre id="out" class="mt"></pre>
  </section>

  <section class="card">
    <h2>Rohwaren (Preise & Einheiten)</h2>
    <table id="prods">
      <thead><tr><th>Code</th><th>Name</th><th>Base</th><th>€ / Base</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>

<script>
async function runSeed(){
  const r = await fetch('/api/seed/full',{method:'POST'});
  const j = await r.json();
  document.getElementById('out').textContent = JSON.stringify(j,null,2);
  loadProds();
}
async function loadProds(){
  const r = await fetch('/api/products'); const j = await r.json();
  const tb = document.querySelector('#prods tbody'); tb.innerHTML='';
  for(const p of j.data){
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${p.code}</td><td>${p.name}</td><td>${p.unit_base}</td><td>${Number(p.price_per_base).toFixed(6)}</td>`;
    tb.appendChild(tr);
  }
}
document.getElementById('seed').onclick = runSeed;
document.getElementById('logout').onclick = async () => { await fetch('/api/logout',{method:'POST'}); location.href='/'; };
loadProds();
</script>
</body>
</html>
