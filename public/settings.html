<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Bakeflow ‚Äî Einstellungen</title>
  <link rel="stylesheet" href="/styles.css"/>
  <script defer src="/js/app.js"></script>
  <style>
    .grid-2{display:grid;gap:14px;grid-template-columns:1fr 1fr}
    @media (max-width:900px){.grid-2{grid-template-columns:1fr}}
    .preview{border:1px solid var(--border);border-radius:12px;overflow:hidden}
    .preview-head{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--border)}
    .preview-body{padding:12px}
    .swatch{width:28px;height:28px;border-radius:50%;border:1px solid var(--border)}
    .row{display:flex;align-items:center;gap:10px}
    .kbd{font-size:12px;padding:2px 8px;border:1px solid var(--border);border-radius:8px;color:var(--text-muted)}
  </style>
</head>
<body>

<header class="header">
  <nav class="nav">
    <div class="brand">üçû Bakeflow ‚Äî Einstellungen</div>
    <div class="menu-wrap">
      <button class="btn" onclick="location.href='/dashboard.html'">Dashboard</button>
      <button class="btn danger" onclick="logout()">Logout</button>
    </div>
  </nav>
</header>

<main class="container">
  <section class="grid-2">
    <!-- Appearance -->
    <div class="card">
      <div class="card-title-row">
        <h2 style="margin:0">Darstellung</h2>
        <div class="row">
          <button class="btn" id="resetLook">Zur√ºcksetzen</button>
        </div>
      </div>
      <div class="card-pad">
        <div class="row" style="justify-content:space-between">
          <div>
            <div class="muted small">Theme</div>
            <div class="row" style="margin-top:6px">
              <button class="btn" id="thDark">Dunkel</button>
              <button class="btn" id="thLight">Hell</button>
            </div>
          </div>
          <div>
            <div class="muted small">Dichte</div>
            <div class="row" style="margin-top:6px">
              <button class="btn" id="dComfy">Komfort</button>
              <button class="btn" id="dCompact">Kompakt</button>
            </div>
          </div>
          <div>
            <div class="muted small">Akzentfarbe</div>
            <div class="row" style="margin-top:6px">
              <input id="accentPicker" type="color" class="input" style="width:44px;height:36px;padding:0"/>
              <div id="accentSwatch" class="swatch"></div>
            </div>
          </div>
        </div>

        <hr class="sep"/>

        <div>
          <div class="muted small">Sprache</div>
          <select id="lang" class="input" style="margin-top:6px;max-width:220px">
            <option value="de">Deutsch (DE)</option>
            <option value="en">English (EN)</option>
          </select>
          <div class="muted small" style="margin-top:6px">* Sprache wirkt auf UI-Texte; Daten bleiben unver√§ndert.</div>
        </div>

        <hr class="sep"/>

        <div class="preview">
          <div class="preview-head">
            <div class="row"><div class="swatch" id="miniAccent"></div><b>Vorschau</b></div>
            <span class="muted small">Wie es aussehen wird</span>
          </div>
          <div class="preview-body">
            <div class="row" style="gap:8px;flex-wrap:wrap">
              <button class="btn">Button</button>
              <button class="btn primary">Primary</button>
              <button class="btn danger">Danger</button>
              <span class="kbd">‚åòK</span><span class="muted small">Befehlspalette</span>
            </div>
            <div class="table-wrap" style="margin-top:10px">
              <table class="table">
                <thead><tr><th>Spalte</th><th>Wert</th></tr></thead>
                <tbody>
                  <tr><td>Akzent</td><td id="pvAccent">‚Äî</td></tr>
                  <tr><td>Theme</td><td id="pvTheme">‚Äî</td></tr>
                  <tr><td>Dichte</td><td id="pvDensity">‚Äî</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- Data helpers / account -->
    <div class="card">
      <div class="card-title-row">
        <h2 style="margin:0">Daten & Konto</h2>
      </div>
      <div class="card-pad">
        <div class="row" style="justify-content:space-between">
          <div>
            <div class="muted small">Letzte Anmeldung</div>
            <div id="lastEmail" class="mono">‚Äî</div>
          </div>
          <button class="btn" id="clearRemember">E-Mail vergessen</button>
        </div>

        <hr class="sep"/>

        <div class="row" style="justify-content:space-between">
          <div>
            <div class="muted small">Cache</div>
            <div class="muted">Browser-Speicher & UI-Einstellungen</div>
          </div>
          <button class="btn danger" id="clearCache">Alles leeren</button>
        </div>

        <hr class="sep"/>

        <div class="row" style="justify-content:space-between;flex-wrap:wrap;gap:10px">
          <div>
            <div class="muted small">Schnellzugriff</div>
            <div class="row" style="margin-top:6px;flex-wrap:wrap;gap:8px">
              <button class="btn" onclick="location.href='/materials.html'">Rohwaren</button>
              <button class="btn" onclick="location.href='/items.html'">Rezepte</button>
              <button class="btn" onclick="location.href='/plan.html'">Plan</button>
              <button class="btn" onclick="location.href='/tools.html'">Data Studio</button>
            </div>
          </div>
        </div>

      </div>
    </div>
  </section>
</main>

<script>
function logout(){ api('/api/logout',{method:'POST'}).then(()=>location.href='/login.html'); }

function applyPreview(){
  const theme = document.documentElement.classList.contains('light') ? 'Hell' : 'Dunkel';
  const density = document.documentElement.classList.contains('compact') ? 'Kompakt' : 'Komfort';
  const accent = getComputedStyle(document.documentElement).getPropertyValue('--accent').trim();
  document.getElementById('pvTheme').textContent = theme;
  document.getElementById('pvDensity').textContent = density;
  document.getElementById('pvAccent').textContent = accent || '#6aa6ff';
  document.getElementById('miniAccent').style.background = `conic-gradient(from 180deg, ${accent}, ${accent})`;
  document.getElementById('accentSwatch').style.background = accent;
}

(function boot(){
  // load remembered email
  const last = localStorage.getItem('bf_last_email') || '‚Äî';
  document.getElementById('lastEmail').textContent = last;

  // accent init
  const picker = document.getElementById('accentPicker');
  const saved = localStorage.getItem('accent');
  picker.value = saved || '#6aa6ff';
  picker.addEventListener('input', (e)=> changeAccent(e.target.value));
  applyPreview();

  // theme/density
  document.getElementById('thDark').onclick = ()=>{ localStorage.setItem('theme','dark'); document.documentElement.classList.remove('light'); applyPreview(); };
  document.getElementById('thLight').onclick = ()=>{ localStorage.setItem('theme','light'); document.documentElement.classList.add('light'); applyPreview(); };
  document.getElementById('dComfy').onclick = ()=>{ localStorage.setItem('density','comfy'); document.documentElement.classList.remove('compact'); applyPreview(); };
  document.getElementById('dCompact').onclick = ()=>{ localStorage.setItem('density','compact'); document.documentElement.classList.add('compact'); applyPreview(); };

  // reset look
  document.getElementById('resetLook').onclick = ()=>{
    localStorage.removeItem('theme'); localStorage.removeItem('density');
    localStorage.removeItem('accent');
    document.documentElement.classList.remove('light','compact');
    changeAccent('#6aa6ff'); picker.value='#6aa6ff';
    applyPreview(); toast('Zur√ºckgesetzt');
  };

  // clear remembered email
  document.getElementById('clearRemember').onclick = ()=>{
    localStorage.removeItem('bf_last_email');
    document.getElementById('lastEmail').textContent = '‚Äî';
    toast('E-Mail entfernt');
  };

  // clear cache
  document.getElementById('clearCache').onclick = ()=>{
    const keep = ['theme','density','accent'];
    const savedVals = keep.map(k=>[k, localStorage.getItem(k)]);
    localStorage.clear();
    savedVals.forEach(([k,v])=> v!=null && localStorage.setItem(k,v));
    toast('Lokale Daten geleert (UI-Einstellungen behalten)');
  };
})();
</script>

</body>
</html>
